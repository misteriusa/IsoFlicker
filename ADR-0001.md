# ADR-0001: Windows-Native IsoFlicker Stack

- **Status**: Accepted
- **Date**: 2024-04-04

## Context

IsoFlickerâ€™s existing toolkit is Python-centric (PyQt + MoviePy). The Windows 11 PRD requires a timing-accurate native renderer leveraging D3D11 waitable swap chains and WASAPI with sample-accurate amplitude modulation. We also need a research-friendly control plane (preset catalog, logging, safety copy) accessible via web UI. A cohesive bootstrap must compress onboarding time while maintaining strict safety/telemetry requirements.

## Decision

1. **Native stimulation core** implemented in C++ with Direct3D 11 and WASAPI. Flip-model swap chain plus QPC telemetry ensures deterministic flicker pacing. Audio rendering runs in a dedicated thread with placeholders for raised-cosine edges and nested envelopes.
2. **Backend service** built with FastAPI + SQLModel, exposing preset metadata, session logging, and export stubs. Catalog data lives in JSON for transparency and offline operation.
3. **Frontend** built with Next.js (App Router) + Tailwind + shadcn-inspired components to surface preset cards, safety messaging, and precision badges.
4. **DevOps** baseline includes Docker, devcontainer, CI workflow (pytest + Vitest), and scripts for bootstrap and ingest to maintain reproducibility.

## Consequences

- Native code introduces a C++ toolchain requirement (MSVC + Windows SDK). We mitigate by isolating it under `windows/` with CMake metadata.
- Backend/frontend split adds more moving parts but enables remote orchestration and data export automation.
- Additional effort is required to finish hardware-level TODOs (`REVIEW` comments). However, the scaffolding now enforces guardrails (WCAG warnings, SPL guidance) and provides hooks for telemetry validation.
